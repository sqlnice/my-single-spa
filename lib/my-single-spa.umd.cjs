(function(l,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(l=typeof globalThis<"u"?globalThis:l||self,m(l.mySingleSpa={}))})(this,function(l){"use strict";const m=Object.freeze(Object.defineProperty({__proto__:null,get registerApplication(){return H},get getAppNames(){return M},get start(){return $}},Symbol.toStringTag,{value:"Module"})),O="NOT_LOADED",D="LOAD_RESOURCE_CODE",j="NOT_BOOTSTRAPPED",V="BOOTSTRAPPING",S="NOT_MOUNTED",z="MOUNTING",h="MOUNTED",J="UNMOUNTING",u="SKIP_BEACUSE_BROKEN",d="LOAD_ERROR";function v(t){return t.status!==u}function q(t){return t.status!==d}function B(t){return t.status!==O&&t.status!==d&&t.status!==D}function x(t){return!B(t)}function _(t){return t.status===h}function Q(t){return!_(t)}function C(t){try{return t.activityWhen(window.location)}catch(e){throw t.status=u,e}}function X(t){try{return!t.activityWhen(window.location)}catch(e){throw t.status=u,e}}const N=/^(hashchange|popstate)$/i,E={hashchange:[],popstate:[]};function A(){g([],arguments)}window.addEventListener("hashchange",A),window.addEventListener("popstate",A);const Y=window.addEventListener,Z=window.removeEventListener;window.addEventListener=function(t,e){if(t&&N.test(t)&&typeof e=="function"){const n=E[t];n.indexOf(e)===-1&&n.push(e)}return Y.apply(this,arguments)},window.removeEventListener=function(t,e){if(t&&N.test(t)&&typeof e=="function"){const n=E[t];n.indexOf(e)>-1&&(E[t]=n.filter(o=>o!==e))}return Z.apply(this,arguments)};const p=window.history.pushState,tt=window.history.replaceState;window.history.pushState=function(t,e,n){const o=p.apply(this,arguments);return A(new PopStateEvent("popstate",{state:t})),o},window.history.replaceState=function(t,e,n){const o=tt.apply(this,arguments);return A(new PopStateEvent("popstate",{state:t})),o};function P(t){if(!t)return;Array.isArray(t)&&(t=t[0]);const e=t.type;!N.test(e)||E[e].forEach(n=>n.apply(window,t))}let L=!1;function $(){if(!L)return L=!0,g()}function et(){return L}const nt={bootstrap:{millisecond:3e3,rejectWhenTimeout:!1},mount:{millisecond:3e3,rejectWhenTimeout:!1},unmount:{millisecond:3e3,rejectWhenTimeout:!1},unload:{millisecond:3e3,rejectWhenTimeout:!1}};function ot(t={}){return{...nt,...t}}function b(t,e,n){return new Promise((o,i)=>{let c=!1;t.then(r=>{c=!0,o(r)}).catch(r=>{c=!0,i(r)}),setTimeout(()=>s(),n.millisecond);function s(){if(c)return;const r=`${e} \u6CA1\u6709\u5728 ${n.millisecond} \u65F6\u95F4\u5185 resolve \u6216 reject`;n.rejectWhenTimeout?i(new Error(r)):console.error(r)}})}function w(t){return{...t.customProps,name:t.name,mySingleSpa:m}}function I(t){return t instanceof Promise?!0:typeof t=="object"&&typeof t.then=="function"&&typeof t.catch=="function"}function rt(t){return typeof t=="function"?!0:Array.isArray(t)?t.filter(e=>typeof e!="function").length===0:!1}function y(t=[]){return Array.isArray(t)||(t=[t]),t.length===0&&(t=[()=>Promise.resolve()]),function(e){return new Promise((n,o)=>{i(0);function i(c){const s=t[c](e);if(!I(s)){o(`${s} \u672A\u8FD4\u56DE promise`);return}s.then(()=>{c===t.length-1?n():i(++c)}).catch(r=>{o(r)})}})}}function W(t){if(t.status!==h)return Promise.resolve(t);t.status=J;function e(o){return b(t.unmount(w(t)),`app: ${t.name} unmounting`,t.timeouts.unmount).catch(i=>{console.log(i),t.status=u}).then(()=>(t.status!==u&&(t.status=o===!0?u:S),t))}return Promise.all(Object.keys(t.services).map(o=>t.services[o].unmountSelf())).catch(o=>(console.log(o),!0)).then(e)}function G(t){if(t.status!==O&&t.status!==d)return Promise.resolve(t);t.status=D;const e=t.loadApp(w(t));return I(e)?e.then(n=>{const o=[];return typeof n!="object"&&o.push(`app: ${t.name} \u6CA1\u6709\u5BFC\u51FA\u4EFB\u4F55\u4E1C\u897F`),["bootstrap","mount","unmount"].forEach(i=>{rt(n[i])||o.push(`app: ${t.name} \u6CA1\u6709\u5BFC\u51FA\u751F\u547D\u5468\u671F: ${i},\u6216\u4E0D\u662F\u4E00\u4E2A\u65B9\u6CD5`)}),o.length?(console.log(o),t.status=u,t):(t.status=j,t.bootstrap=y(n.bootstrap),t.mount=y(n.mount),t.unmount=y(n.unmount),t.unload=y(n.unload),t.timeouts=ot(n.timeouts),t)}).catch(n=>(console.log(n),t.status=d,t)):(console.log("app loadFunction must return a promise"),t.status=u,Promise.resolve(t))}function K(t){return t.status!==j?Promise.resolve(t):(t.status=V,b(t.bootstrap(w(t)),`app: ${t.name} bootstrapping`,t.timeouts.bootstrap).then(()=>(t.status=S,t)).catch(e=>(console.log(e),t.status=u,t)))}function k(t){return t.status!==S?Promise.resolve(t):(t.status=z,b(t.mount(w(t)),`app: ${t.name} mounting`,t.timeouts.mount).then(()=>{t.status=h}).catch(e=>(console.log(e),t.status=h,W(t).catch(n=>{console.log(n)}).then(()=>(t.status=u,t)))))}let U=!1,T=[];function g(t=[],e){if(U)return new Promise((s,r)=>{T.push({success:s,failure:r,eventArgs:e})});if(U=!0,et())return n();return o();function n(){const s=it(),r=Promise.all(s.map(W)),ct=F().map(f=>G(f).then(R=>K(R)).then(()=>r).then(()=>k(f))),ft=st().map(f=>K(f).then(()=>r).then(()=>k(f)));return r.then(()=>{P();const f=ct.concat(ft);return Promise.all(f).then(i,R=>{t.forEach(lt=>lt.reject(R))})},f=>{throw P(),console.log(f),f})}function o(){const s=F().map(G);return Promise.all(s).then(()=>(c(),i())).catch(r=>{c(),console.log(r)})}function i(){const s=ut();if(t!=null&&t.length&&t.forEach(r=>r.success(s)),U=!1,T.length){const r=T;return T=[],g(r)}return s}function c(){t.length&&t.filter(s=>s.eventArgs).forEach(s=>P(s.eventArgs)),e&&P(e)}}const a=[];function M(){return a.map(({name:t})=>t)}function F(){return a.filter(v).filter(q).filter(x).filter(C)}function st(){return a.filter(v).filter(B).filter(Q).filter(C)}function it(){return a.filter(v).filter(_).filter(X)}function ut(){return a.filter(_).map(t=>t)}function H(t,e,n,o={}){if(!t||typeof t!="string")throw new Error("\u53C2\u6570:appName \u4E0D\u80FD\u4E3A\u7A7A\u5B57\u7B26\u4E32");if(M().includes(t))throw new Error(`\u5B50\u5E94\u7528appName: ${t} \u5DF2\u6CE8\u518C`);if(!e)throw new Error("\u7F3A\u5C11\u53C2\u6570: applicationOrLoadFunction");if(typeof n!="function")throw new Error("\u53C2\u6570: activityWhen \u683C\u5F0F\u5FC5\u987B\u4E3A Function");if(typeof o!="object"||Array.isArray(o))throw new Error("\u53C2\u6570:customProps \u683C\u5F0F\u5FC5\u987B\u4E3A Object");return typeof e!="function"&&(e=()=>Promise.resolve(e)),a.push({name:t,loadApp:e,activityWhen:n,customProps:o,status:O,services:[]}),g()}l.getAppNames=M,l.registerApplication=H,l.start=$,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=my-single-spa.umd.cjs.map
